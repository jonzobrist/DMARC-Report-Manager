#!/bin/bash

# DMARC Report Manager - Stop Script

PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
RUN_DIR="${PROJECT_ROOT}/.run"

# Colors
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
RED='\033[0;31m'
NC='\033[0m'

stop_service() {
    local SERVICE_NAME=${1}
    local PID_FILE="${RUN_DIR}/${SERVICE_NAME}.pid"

    if [ -f "${PID_FILE}" ]; then
        PID=$(cat "${PID_FILE}")
        if kill -0 "${PID}" 2>/dev/null; then
            echo "Stopping ${SERVICE_NAME} (PID: ${PID})..."
            kill "${PID}"
            rm "${PID_FILE}"
            echo -e "${GREEN}${SERVICE_NAME} stopped.${NC}"
        else
            echo -e "${YELLOW}${SERVICE_NAME} is not running (stale PID file removed).${NC}"
            rm "${PID_FILE}"
        fi
    else
        echo -e "${YELLOW}${SERVICE_NAME} is not running.${NC}"
    fi
}

echo "Stopping DMARC Report Manager services..."

stop_service "backend"
stop_service "frontend"

echo "All services stopped."
